(this["webpackJsonpreact-sn"]=this["webpackJsonpreact-sn"]||[]).push([[6],{397:function(e,n,t){"use strict";t.r(n);var r=t(10),c=t(0),s=t.n(c),u=t(24),a=t(20),i=t.n(a),o=t(36),l=t(13),d={"message-received":[],"status-changed":[]},f=null,v=function(){p("pending"),setTimeout(g,3e3)},j=function(e){var n=JSON.parse(e.data);d["message-received"].forEach((function(e){return e(n)}))},h=function(){p("ready")},b=function(){p("error")};function O(){var e,n,t,r;null===(e=f)||void 0===e||e.removeEventListener("close",v),null===(n=f)||void 0===n||n.removeEventListener("message",j),null===(t=f)||void 0===t||t.removeEventListener("open",h),null===(r=f)||void 0===r||r.removeEventListener("error",b)}var p=function(e){d["status-changed"].forEach((function(n){return n(e)}))};function g(){var e;O(),null===(e=f)||void 0===e||e.close(),f=new WebSocket("wss://social-network.samuraijs.com/handlers/ChatHandler.ashx"),p("pending"),f.addEventListener("close",v),f.addEventListener("message",j),f.addEventListener("open",h),f.addEventListener("error",b)}var m=function(){g()},x=function(){var e;d["message-received"]=[],d["status-changed"]=[],O(),null===(e=f)||void 0===e||e.close()},w=function(e,n){return d[e].push(n),function(){d[e]=d[e].filter((function(e){return e!==n}))}},E=function(e,n){d[e]=d[e].filter((function(e){return e!==n}))},y=function(e){var n;null===(n=f)||void 0===n||n.send(e)},k=null,L=function(e){return null===k&&(k=function(n){e(function(e){return{type:l.h,payload:e}}(n))}),k},S=null,T=function(e){return null===S&&(S=function(n){e(function(e){return{type:l.q,status:e}}(n))}),S},C=t(1),H=function(){var e=Object(u.c)(),n=Object(u.d)((function(e){return e.chat.status}));return Object(c.useEffect)((function(){return e(function(){var e=Object(o.a)(i.a.mark((function e(n){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:m(),w("message-received",L(n)),w("status-changed",T(n));case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()),function(){e(function(){var e=Object(o.a)(i.a.mark((function e(n){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:E("message-received",L(n)),E("status-changed",T(n)),x();case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}())}}),[]),Object(C.jsxs)("div",{children:["error"===n&&Object(C.jsx)("div",{children:"Error. Please refresh the page"}),Object(C.jsxs)(C.Fragment,{children:[Object(C.jsx)(J,{}),Object(C.jsx)(P,{})]})]})},J=function(){var e=Object(u.d)((function(e){return e.chat.messages})),n=Object(c.useRef)(null),t=Object(c.useState)(!1),s=Object(r.a)(t,2),a=s[0],i=s[1];Object(c.useEffect)((function(){var e;a&&(null===(e=n.current)||void 0===e||e.scrollIntoView({behavior:"smooth"}))}),[e]);return Object(C.jsxs)("div",{style:{height:"400px",overflowY:"auto"},onScroll:function(e){var n=e.currentTarget;Math.abs(n.scrollHeight-n.scrollTop)-n.clientHeight<300?!a&&i(!0):!a&&i(!1)},children:[e.map((function(e,n){return Object(C.jsx)(N,{message:e},n)})),Object(C.jsx)("div",{ref:n})]})},N=s.a.memo((function(e){var n=e.message;return Object(C.jsxs)("div",{children:[Object(C.jsx)("img",{width:35,height:35,src:n.photo,alt:"avatar"}),Object(C.jsx)("b",{children:n.userName}),Object(C.jsx)("br",{}),n.message,Object(C.jsx)("hr",{})]})})),P=function(){var e=Object(u.c)(),n=Object(c.useState)(""),t=Object(r.a)(n,2),s=t[0],a=t[1],l=Object(u.d)((function(e){return e.chat.status})),d=function(){var n;s&&(e((n=s,function(){var e=Object(o.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:y(n);case 1:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}())),a(""))};return Object(C.jsxs)("div",{children:[Object(C.jsx)("div",{children:Object(C.jsx)("textarea",{onKeyPress:function(e){"Enter"===e.code&&d()},onChange:function(e){return a(e.currentTarget.value)},value:s})}),Object(C.jsx)("div",{children:Object(C.jsx)("button",{disabled:"ready"!==l,onClick:d,children:"send"})})]})};n.default=function(e){return Object(C.jsxs)("div",{children:[Object(C.jsx)("h1",{children:"chat"}),Object(C.jsx)(H,{})]})}}}]);
//# sourceMappingURL=6.41ce1fac.chunk.js.map